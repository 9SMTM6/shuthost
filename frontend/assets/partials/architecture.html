<section id="architecture-tab" class="tab-content">
    { platform_support }

    <article class="section-container mt-0">
        <header>
            <h2 class="section-title px-4 pt-4">Architecture Documentation</h2>
            <p class="description-text px-4">ShutHost's architecture is built around three core components: the
                Coordinator, Host Agents, and optional Clients for programmatic control.</p>
        </header>

        <section class="architecture-section" aria-labelledby="host-agent-interaction-title">
            <header>
                <h3 id="host-agent-interaction-title" class="architecture-title px-4">Core Components &amp; Interactions
                </h3>
            </header>
            <figure class="architecture-diagram-container">
                <img src="{ host_agent_interaction }" loading="lazy" alt="Host-Agent-Coordinator Interaction Diagram"
                    class="architecture-diagram">
            </figure>
            <div class="architecture-content">
                <aside class="alert alert-info" role="note" aria-label="Component Roles">
                    <h4 class="alert-title">Component Roles</h4>
                    <ul class="text-sm">
                        <li><strong>Coordinator:</strong> Central control point that serves the WebUI and API. Sends
                            Wake-on-LAN packets to start hosts and forwards authenticated shutdown requests</li>
                        <li><strong>Host Agent:</strong> Lightweight service running on each managed host. Handles
                            shutdown commands, responds to status pings, and integrates with the system's init system
                            (systemd, openrc, launchd)</li>
                        <li><strong>Direct Control Script:</strong> Optional standalone script for LAN-only control
                            without a coordinator</li>
                    </ul>
                </aside>
                <aside class="alert alert-info" role="note" aria-label="Communication Flow">
                    <h4 class="alert-title">Communication Flow</h4>
                    <ul class="text-sm">
                        <li><strong>Startup:</strong> Coordinator sends Wake-on-LAN (WOL) broadcast packets to power on
                            hosts</li>
                        <li><strong>Shutdown:</strong> Coordinator sends authenticated, timestamped shutdown requests to
                            the agent, which executes the shutdown</li>
                        <li><strong>Status:</strong> Coordinator periodically pings agents to verify host availability
                        </li>
                        <li><strong>Agent Lifecycle:</strong> The agent starts automatically on boot via the system's
                            init service</li>
                    </ul>
                </aside>
            </div>
        </section>

        <section class="architecture-section architecture-separator" aria-labelledby="lease-system-title">
            <header>
                <h3 id="lease-system-title" class="architecture-title px-4">Lease System &amp; Multi-Client Access</h3>
            </header>
            <figure class="architecture-diagram-container">
                <img src="{ client_controller_interaction }" loading="lazy"
                    alt="Client-Coordinator-Host Lease System Diagram" class="architecture-diagram">
            </figure>
            <div class="architecture-content">
                <p class="architecture-when-to-use px-4">
                    <strong>When leases matter:</strong> When you have <strong>clients defined</strong> in your
                    configuration or multiple entities (WebUI + scripts) accessing hosts, the lease system prevents
                    conflicts and ensures hosts stay online while in use.
                </p>
                <aside class="alert alert-warning" role="note" aria-label="Lease System">
                    <h4 class="alert-title">How Leases Work</h4>
                    <p class="text-sm">
                        The lease system coordinates access when multiple clients or the WebUI need to use hosts
                        simultaneously:
                    </p>
                    <ul class="text-sm mt-2">
                        <li><strong>Lease Acquisition:</strong> Clients and WebUI request leases before accessing hosts
                        </li>
                        <li><strong>Automatic Startup:</strong> Hosts are automatically started when the first lease is
                            acquired (lease count â‰¥1)</li>
                        <li><strong>Automatic Shutdown:</strong> Hosts are automatically shut down when all leases are
                            released (lease count = 0)</li>
                        <li><strong>Conflict Prevention:</strong> Ensures hosts aren't shut down while still in use by
                            other clients or the WebUI</li>
                        <li><strong>Transparent to Users:</strong> When using only the WebUI without defined clients,
                            the lease system operates automatically in the background</li>
                    </ul>
                </aside>
                <aside class="alert alert-info" role="note" aria-label="Client Use Cases">
                    <h4 class="alert-title">Client Use Cases</h4>
                    <p class="text-sm">Clients enable programmatic control for automated tasks:</p>
                    <ul class="text-sm mt-2">
                        <li><strong>Automated Backups:</strong> Scripts acquire a lease, wake the host, perform backups,
                            then release the lease to allow shutdown</li>
                        <li><strong>Batch Processing:</strong> Jobs that need temporary access to specific hosts for
                            processing tasks</li>
                        <li><strong>CI/CD Pipelines:</strong> Build systems that need on-demand access to powerful build
                            machines</li>
                        <li><strong>Scheduled Maintenance:</strong> Scripts that perform regular maintenance while
                            preventing other shutdowns</li>
                    </ul>
                </aside>
            </div>
        </section>

        <section class="architecture-section architecture-separator" aria-labelledby="deployment-options-title">
            <header>
                <h3 id="deployment-options-title" class="architecture-title px-4">Deployment Options</h3>
            </header>
            <figure class="architecture-diagram-container">
                <img src="{ deployment }" loading="lazy" alt="Deployment Options Diagram" class="architecture-diagram">
            </figure>
            <div class="architecture-content">
                <aside class="alert alert-info" role="note" aria-label="Deployment Paths">
                    <h4 class="alert-title">Installation Paths</h4>
                    <ul class="text-sm">
                        <li><strong>Full Deployment:</strong> Install the coordinator (binary or Docker) on an
                            always-on host, then use the WebUI to generate and install agents and clients</li>
                        <li><strong>Agent-Only:</strong> Install only the host agent on each managed host and use
                            generated direct-control scripts for local LAN control (no coordinator needed)</li>
                        <li><strong>Manual Registration:</strong> Agents and clients must be manually registered with
                            the coordinator after installation</li>
                        <li><strong>WOL Testing:</strong> The coordinator's installer includes connectivity tests to
                            verify Wake-on-LAN functionality</li>
                    </ul>
                </aside>
            </div>
        </section>

        <section class="architecture-section architecture-separator" aria-labelledby="direct-control-title">
            <header>
                <h3 id="direct-control-title" class="architecture-title px-4">Direct Control vs. Coordinator</h3>
            </header>
            <figure class="architecture-diagram-container">
                <img src="{ direct_control_comparison }" loading="lazy"
                    alt="Direct Control vs Coordinator Comparison Diagram" class="architecture-diagram">
            </figure>
            <div class="architecture-content">
                <aside class="alert alert-warning" role="note" aria-label="Network Limitations">
                    <h4 class="alert-title">LAN Limitation</h4>
                    <p class="text-sm">
                        <strong>Direct Control Scripts:</strong> Work only on the same LAN as the managed hosts because
                        Wake-on-LAN requires local broadcast. These scripts cannot control hosts from outside your local
                        network.
                    </p>
                </aside>
                <aside class="alert alert-info" role="note" aria-label="Coordinator Benefits">
                    <h4 class="alert-title">Coordinator Benefits</h4>
                    <ul class="text-sm">
                        <li><strong>Remote Access:</strong> The WebUI can control hosts from anywhere when the
                            coordinator is exposed via domain/tunnel</li>
                        <li><strong>Centralized Management:</strong> Single interface for all hosts</li>
                        <li><strong>Multi-Client Coordination:</strong> Lease system prevents conflicts</li>
                        <li><strong>Web-Based:</strong> No local scripts needed, works from any device with a browser
                        </li>
                    </ul>
                </aside>
            </div>
        </section>

        <section class="architecture-key-points" aria-labelledby="architecture-key-points-title">
            <aside class="alert alert-info" role="note" aria-label="Key Points">
                <h4 id="architecture-key-points-title" class="alert-title">ðŸ’¡ Key Takeaways</h4>
                <ul class="text-sm">
                    <li><strong>Security-First Design:</strong> Authenticated shutdown requests with HMAC signatures and
                        timestamps prevent unauthorized access and replay attacks</li>
                    <li><strong>Minimal Agent:</strong> Host agents are lightweight, run with necessary privileges, and
                        integrate with system init services</li>
                    <li><strong>Flexible Deployment:</strong> Choose between full coordinator deployment for remote
                        access or agent-only for simple LAN control</li>
                    <li><strong>Wake-on-LAN Foundation:</strong> Uses standard WOL for startup; adds secure shutdown
                        capability that doesn't exist in standard protocols</li>
                    <li><strong>Optional Coordination:</strong> Lease system activates when needed for multi-client
                        scenarios, stays transparent for single-user WebUI usage</li>
                </ul>
            </aside>
        </section>
    </article>
</section>
