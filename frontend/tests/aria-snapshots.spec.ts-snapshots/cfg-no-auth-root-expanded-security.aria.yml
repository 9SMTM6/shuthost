- main:
  - region:
    - region "ðŸ”’ Required Security Exceptions":
      - text: "Important: No Internal Authentication, or outdated External Auth config"
      - paragraph: If you do not configure external authentication (reverse proxy auth) or an internal authentication mode (Token or OIDC), the web UI will allow any visitor to switch hosts on or off. This is a security risk.
      - paragraph: "Options:"
      - list:
        - listitem: Enable the built-in Token (easy to configure) or OIDC authentication in the coordinator config.
        - listitem:
          - text: Use an external authentication gateway (reverse proxy) and set the
          - code: exceptions_version
          - text: in your auth config to acknowledge you have configured the required bypass rules.
      - paragraph:
        - emphasis: When using an external auth reverse proxy, you must allow unauthenticated access to certain endpoints so installers and machine-to-machine clients can work. See the examples below.
      - group "ðŸ”’ Required Security Exceptions":
        - heading "ðŸ”’ Required Security Exceptions" [level=2]
        - region "ðŸ”’ Required Security Exceptions":
          - paragraph: "For the web app and installation scripts to work properly, these endpoints must be reachable without authentication. If your reverse proxy enforces authentication (Authelia, NPM with auth, etc.), create bypass rules for:"
          - list:
            - listitem:
              - code: /download/*
              - text: "- Installation script and binary downloads"
            - listitem:
              - code: /api/m2m/*
              - text: "- Machine-to-machine API communication used by agents/clients"
            - listitem:
              - code: /manifest.*.json
              - text: "- PWA manifest required for webpage installability"
            - listitem:
              - code: /favicon.*.svg
              - text: "- Favicon required for browser installability"
          - paragraph:
            - emphasis: These exceptions let installer scripts and the web UI fetch resources and allow agent clients to call machine-to-machine APIs without user login. The manifest and favicon entries are necessary for correct browser/PWA behaviour.
          - paragraph: "Authelia:"
          - button "Copy Authelia config"
          - code: "- domain: <base_url> policy: bypass resources: - '^/download/(.*)' - '^/api/m2m/(.*)$' - '/manifest..*.json$' - '/favicon..*.svg$'"
          - paragraph: "Nginx Proxy Manager with Authentication:"
          - button "Copy Nginx config"
          - code: "# In your proxy host's advanced configuration location ~ ^/(download|api/m2m|manifest\\..*\\.json|favicon\\..*\\.svg)$ { auth_basic off; proxy_pass http://your-shuthost-backend; }"
          - paragraph: "Traefik with ForwardAuth:"
          - button "Copy Traefik config"
          - code: "/# Add to your service labels - \"traefik\\.http\\.routers\\.shuthost-bypass\\.rule=Host\\(`<base_url>`\\) && \\(PathPrefix\\(`\\/download`\\) \\|\\| PathPrefix\\(`\\/api\\/m2m`\\) \\|\\| PathRegexp\\(`\\/manifest\\\\\\.\\.\\*\\\\\\.json`\\) \\|\\| PathRegexp\\(`\\/favicon\\\\\\.\\.\\*\\\\\\.svg`\\)\\)\" - \"traefik\\.http\\.routers\\.shuthost-bypass\\.priority=\\d+\" # Remove auth middleware for bypass routes/"
          - paragraph:
            - emphasis:
              - text: Replace backend references with your actual configuration values. After configuring your proxy rules, set
              - code: "auth = {{ type = \"external\", exceptions_version = 1 }}"
              - text: in the coordinator config to acknowledge the exceptions. If this doesn't help, please raise an issue
    - tabpanel:
      - region "Install Host Agent":
        - group "Install Host Agent":
          - heading "Install Host Agent" [level=2]
      - region "Hosts Table":
        - heading "Hosts Table" [level=2]
        - table:
          - rowgroup:
            - row "Host Status Actions":
              - columnheader "Host"
              - columnheader "Status"
              - columnheader "Actions"
          - rowgroup